# AI Telegram Bot

[![CI](https://github.com/jewishcoder/ai-tg-bot/actions/workflows/ci.yml/badge.svg)](https://github.com/jewishcoder/ai-tg-bot/actions/workflows/ci.yml)
[![Coverage](https://img.shields.io/badge/coverage-89%25-brightgreen.svg)](./htmlcov/index.html)
[![Tests](https://img.shields.io/badge/tests-117%20passing-brightgreen.svg)](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
[![Python](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue.svg)](https://www.postgresql.org/)

**LLM-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –≤ –≤–∏–¥–µ Telegram-–±–æ—Ç–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π OpenRouter API.**

–ù–∞–¥–µ–∂–Ω—ã–π, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∏ —Ö–æ—Ä–æ—à–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–æ—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ LLM –º–æ–¥–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π API.

---

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ü§ñ –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç
- üß† –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±—ã—Ö LLM –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ [OpenRouter](https://openrouter.ai)
- üé≠ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ä–æ–ª–∏ (—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç)
- üí¨ –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ —Å –∏—Å—Ç–æ—Ä–∏–µ–π
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –º–æ–¥–µ–ª—å –ø—Ä–∏ —Å–±–æ—è—Ö

### üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚ö° **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç spam –∏ DDoS
- üîÅ **Error recovery** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ retry —Å exponential backoff
- üö¶ **Graceful shutdown** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á
- üîí **Security hardening** - sanitization –ª–æ–≥–æ–≤, –∑–∞—â–∏—Ç–∞ sensitive –¥–∞–Ω–Ω—ã—Ö
- üéØ **Transactional integrity** - –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- üöÄ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - TTL cache –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ (5 –º–∏–Ω)
- üîç **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ë–î, lazy loading
- üíæ **Connection pooling** - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL
- ‚è±Ô∏è **Async –≤—Å—ë** - –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- üêò **PostgreSQL 16** - –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- üîÑ **Alembic** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ —Å—Ö–µ–º—ã
- üóëÔ∏è **Soft delete** - –¥–∞–Ω–Ω—ã–µ –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏
- üë§ **Per-user –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã –∏ –ø—Ä–æ–º–ø—Ç—ã

### üß™ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- ‚úÖ **117 —Ç–µ—Å—Ç–æ–≤** (89% coverage)
- üîç **–°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è** (Mypy strict mode)
- üìè **Code quality** (Ruff linter + formatter)
- ü™ù **Pre-commit hooks** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- ü§ñ **CI/CD** - GitHub Actions

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- üê≥ **[–ó–∞–ø—É—Å–∫ –≤ Docker](#-–∑–∞–ø—É—Å–∫-—á–µ—Ä–µ–∑-docker-—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)** - —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±
- üíª **[–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫](#-–ª–æ–∫–∞–ª—å–Ω—ã–π-–∑–∞–ø—É—Å–∫-–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)** - –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- üöÄ **[Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-production-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)** - deployment guide

### üìñ –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- üîß **[API Reference](docs/api/README.md)** - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ API –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  - [Bot API](docs/api/bot.md) - –≥–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
  - [Storage API](docs/api/storage.md) - —Ä–∞–±–æ—Ç–∞ —Å –ë–î –∏ –∏—Å—Ç–æ—Ä–∏–µ–π
  - [LLM Client API](docs/api/llm_client.md) - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LLM
  - [Database API](docs/api/database.md) - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ PostgreSQL
  - [Handlers API](docs/api/handlers.md) - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- üìã **[vision.md](docs/vision.md)** - —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –≤–∏–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- üó∫Ô∏è **[roadmap.md](docs/roadmap.md)** - –ø–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è (3 —Å–ø—Ä–∏–Ω—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ)
- ü§ù **[CONTRIBUTING.md](CONTRIBUTING.md)** - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∫–æ–Ω—Ç—Ä–∏–±—É—Ü–∏–∏
- üìù **[CHANGELOG.md](CHANGELOG.md)** - –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- üé® **[Visual Guide](docs/guides/VISUAL_GUIDE.md)** - –≤–∏–∑—É–∞–ª—å–Ω—ã–π –æ–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üìö –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
- üìñ **[–í—Å–µ –≥–∞–π–¥—ã](docs/guides/README.md)** - –ø–æ–ª–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- üê≥ **[DOCKER.md](DOCKER.md)** - —Ä–∞–±–æ—Ç–∞ —Å Docker
- üõ°Ô∏è **[FALLBACK.md](docs/FALLBACK.md)** - fallback –º–µ—Ö–∞–Ω–∏–∑–º

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

**–û–±—â–∏–µ:**
- Telegram Bot Token (–ø–æ–ª—É—á–∏—Ç—å —É [@BotFather](https://t.me/botfather))
- OpenRouter API Key (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ [openrouter.ai](https://openrouter.ai))

**–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
- [Docker Desktop](https://www.docker.com/products/docker-desktop/) –∏–ª–∏ Docker Engine
- Docker Compose v2.0+

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:**
- Python 3.11+
- [uv](https://github.com/astral-sh/uv) - –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

### üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**

```bash
git clone <repository-url>
cd ai-tg-bot

# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –±–æ—Ç–∞
cp backend/bot/.env.example backend/bot/.env.development

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ backend/bot/.env.development:
# - TELEGRAM_TOKEN (–ø–æ–ª—É—á–∏—Ç—å —É @BotFather)
# - OPENROUTER_API_KEY (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ openrouter.ai)
# - DB_PASSWORD (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è PostgreSQL)

# –°–æ–∑–¥–∞—Ç—å .env –¥–ª—è Docker Compose (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–î)
# echo "DB_USER=botuser" > .env
# echo "DB_PASSWORD=your_secure_password" >> .env
# echo "DB_NAME=ai_tg_bot" >> .env
```

**–í–∞–∂–Ω–æ:** 
- `backend/bot/.env.development` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ (–º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
- `.env` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Docker Compose (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã PostgreSQL)

**2. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å:**

```bash
# –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑
docker-compose build

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f bot
```

**3. –û—Å—Ç–∞–Ω–æ–≤–∫–∞:**

```bash
docker-compose down
```

üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [DOCKER.md](DOCKER.md)

---

### üíª –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

**1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**

```bash
git clone <repository-url>
cd ai-tg-bot
cp backend/bot/.env.example backend/bot/.env.development

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ backend/bot/.env.development:
# - TELEGRAM_TOKEN –∏ OPENROUTER_API_KEY
# - DB_HOST=localhost (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤–º–µ—Å—Ç–æ 'postgres')
```

**2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

```bash
uv sync
```

**3. –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL:**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ PostgreSQL —á–µ—Ä–µ–∑ Docker
docker-compose up postgres -d

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make db-migrate
```

**4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞:**

**–ß–µ—Ä–µ–∑ Makefile (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
```bash
make run
```

**–ß–µ—Ä–µ–∑ UV –Ω–∞–ø—Ä—è–º—É—é:**
```bash
cd backend/bot
uv run python -m src.main --env-file .env.development
```

**–ß–µ—Ä–µ–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
```bash
cd backend/bot
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
source .venv/bin/activate  # Linux/Mac
# –∏–ª–∏
.venv\Scripts\activate     # Windows

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python -m src.main --env-file .env.development
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

- **`users`** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö Telegram
- **`messages`** - –∏—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (—Å soft delete —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π)
- **`user_settings`** - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ª–∏–º–∏—Ç—ã, –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã)

üìñ –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: [Database API](docs/api/database.md)

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
make db-migrate

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
make db-rollback

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
make db-revision message="Add new field"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ë–î
make db-current
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# –í backend/bot/.env.development (–∏–ª–∏ .env –¥–ª—è Docker Compose)
DB_HOST=postgres         # –î–ª—è Docker: postgres; –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ: localhost
DB_PORT=5432            # –ü–æ—Ä—Ç –ë–î
DB_NAME=ai_tg_bot       # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
DB_USER=botuser         # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î
DB_PASSWORD=your_secure_password  # –í–ê–ñ–ù–û: –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å!
DB_ECHO=False           # SQLAlchemy echo (True –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ SQL)
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –∏ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!

---

## üìã –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| `/start` | –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º |
| `/help` | –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º |
| `/role <—Ç–µ–∫—Å—Ç>` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ (—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç) |
| `/role default` | –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| `/reset` | –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ |
| `/status` | –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É |

---

## üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å

### Fallback –º–æ–¥–µ–ª—å

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—É—é LLM –º–æ–¥–µ–ª—å** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–æ–π. –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞—Ç –æ—Ç–≤–µ—Ç.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞** (rate limit, —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—à–∏–±–∫–∞) ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ fallback –º–æ–¥–µ–ª—å
2. **Fallback –º–æ–¥–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç** ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç (–Ω–µ –≤–∏–¥–∏—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π)
3. **–û–±–µ –º–æ–¥–µ–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã** ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

```bash
# –í backend/bot/.env.development (–∏–ª–∏ .env –¥–ª—è production)

# –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å (–ø–ª–∞—Ç–Ω–∞—è, –º–æ—â–Ω–∞—è)
OPENROUTER_MODEL=anthropic/claude-3.5-sonnet

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –º–æ–¥–µ–ª—å (–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è, –±—ã—Å—Ç—Ä–∞—è)
OPENROUTER_FALLBACK_MODEL=meta-llama/llama-3.1-8b-instruct:free
```

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ fallback –º–æ–¥–µ–ª–∏:**

| –ú–æ–¥–µ–ª—å | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ |
|--------|--------------|------------|
| `meta-llama/llama-3.1-8b-instruct:free` | –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è, –±—ã—Å—Ç—Ä–∞—è | –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∏–∂–µ –ø–ª–∞—Ç–Ω—ã—Ö |
| `google/gemini-flash-1.5` | –ë—ã—Å—Ç—Ä–∞—è, –¥–æ—Å—Ç—É–ø–Ω–∞—è | –ü–ª–∞—Ç–Ω–∞—è (–¥–µ—à–µ–≤–∞—è) |
| `openai/gpt-3.5-turbo` | –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ | –ü–ª–∞—Ç–Ω–∞—è |

üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [docs/FALLBACK.md](docs/FALLBACK.md)

---

## üöÄ Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

–î–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ named volumes.

**1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.build/docker-compose.prod.yml` –∏ —É–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ —Ç–æ–∫–µ–Ω—ã:

```yaml
environment:
  - TELEGRAM_TOKEN=your_telegram_bot_token_here
  - OPENROUTER_API_KEY=your_openrouter_api_key_here
  # –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã
```

**2. –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å:**

**Windows PowerShell:**
```powershell
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
.\.build\build-prod.ps1

# –ó–∞–ø—É—Å–∫
docker-compose -f .build/docker-compose.prod.yml up -d
```

**Linux/Mac:**
```bash
# –°–±–æ—Ä–∫–∞
docker-compose -f .build/docker-compose.prod.yml build

# –ó–∞–ø—É—Å–∫
docker-compose -f .build/docker-compose.prod.yml up -d
```

**3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**

```bash
docker-compose -f .build/docker-compose.prod.yml logs -f bot
```

üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [.build/DEPLOYMENT.md](.build/DEPLOYMENT.md)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ production —Å–±–æ—Ä–∫–∏:**
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–±—Ä–∞–∑)
- ‚úÖ Named volumes (Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞–º–∏)
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ (~150-200MB)
- ‚úÖ Multi-stage build –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π healthcheck
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã —Ä–µ—Å—É—Ä—Å–æ–≤
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows, Linux –∏ –≤ –æ–±–ª–∞–∫–µ

---

## üõ†Ô∏è Development

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd ai-tg-bot

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å dev-–ø–∞–∫–µ—Ç–∞–º–∏
uv sync --all-extras

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pre-commit hooks
make pre-commit-install
```

Pre-commit hooks –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª–∏–Ω—Ç–∏–Ω–≥ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make format

# –õ–∏–Ω—Ç–∏–Ω–≥ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
make lint

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test        # –° coverage –æ—Ç—á—ë—Ç–æ–º
make test-fast   # –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ coverage

# –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ä–∞–∑—É (–∫–∞–∫ –≤ CI)
make ci
```

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- ‚úÖ **117 —Ç–µ—Å—Ç–æ–≤** (100% passing)
  - 25 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
  - 92 unit —Ç–µ—Å—Ç–æ–≤
- üìä **Coverage: 89%** (—Ü–µ–ª—å: 70%+ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏)
- ‚ö° **–ë—ã—Å—Ç—Ä—ã–µ**: ~5-10 —Å–µ–∫—É–Ω–¥ –Ω–∞ –ø–æ–ª–Ω—ã–π –ø—Ä–æ–≥–æ–Ω

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:**
```
tests/
‚îú‚îÄ‚îÄ integration/          # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Å —Ä–µ–∞–ª—å–Ω–æ–π SQLite –ë–î)
‚îÇ   ‚îú‚îÄ‚îÄ test_storage_integration.py
‚îÇ   ‚îî‚îÄ‚îÄ test_handlers_integration.py
‚îú‚îÄ‚îÄ test_*.py            # Unit —Ç–µ—Å—Ç—ã (—Å –º–æ–∫–∞–º–∏)
‚îî‚îÄ‚îÄ conftest.py          # –§–∏–∫—Å—Ç—É—Ä—ã
```

**Naming conventions –¥–ª—è —Ñ–∏–∫—Å—Ç—É—Ä:**
- `mock_*` - Mock-–æ–±—ä–µ–∫—Ç—ã –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- `test_*` - –†–µ–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
- `sample_*` - –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –ø—Ä–∏–º–µ—Ä—ã

üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [CONTRIBUTING.md - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](CONTRIBUTING.md#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∞

- ‚úÖ **–û–¥–∏–Ω –∫–ª–∞—Å—Å = –æ–¥–∏–Ω —Ñ–∞–π–ª** (Single Responsibility Principle)
- ‚úÖ **Type hints** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ **Docstrings** –¥–ª—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- ‚úÖ **Async/await** –¥–ª—è –≤—Å–µ—Ö I/O –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π (–Ω–µ `print()`)
- ‚úÖ **KISS –ø—Ä–∏–Ω—Ü–∏–ø** - –ø—Ä–æ—Å—Ç–æ—Ç–∞ –ø—Ä–µ–≤—ã—à–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [docs/vision.md](docs/vision.md) –∏ [CONTRIBUTING.md](CONTRIBUTING.md)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Backend:**
- Python 3.11+
- aiogram 3.x - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram Bot API
- OpenAI SDK - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OpenRouter API
- PostgreSQL 16 - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- SQLAlchemy 2.0 - async ORM
- Alembic - —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- Pydantic - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- Ruff - –ª–∏–Ω—Ç–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä
- Mypy - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ (strict mode)
- Pytest - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (117 —Ç–µ—Å—Ç–æ–≤, 89% coverage)
- Pre-commit - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

**DevOps:**
- Docker + Docker Compose - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- GitHub Actions - CI/CD
- Yandex Container Registry - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤

üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [API Reference](docs/api/README.md)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ai-tg-bot/
‚îú‚îÄ‚îÄ src/                 # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ bot.py           # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å Telegram-–±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ llm_client.py    # –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM
‚îÇ   ‚îú‚îÄ‚îÄ storage.py       # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–µ–π –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ database.py      # Database engine –∏ session management
‚îÇ   ‚îú‚îÄ‚îÄ models.py        # SQLAlchemy –º–æ–¥–µ–ª–∏ (User, Message, UserSettings)
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ handlers/        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/     # Middleware (rate limiting)
‚îÇ   ‚îî‚îÄ‚îÄ utils/           # –£—Ç–∏–ª–∏—Ç—ã (message_splitter, log_sanitizer)
‚îú‚îÄ‚îÄ tests/               # –¢–µ—Å—Ç—ã (117 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ integration/     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (25)
‚îÇ   ‚îî‚îÄ‚îÄ test_*.py        # Unit —Ç–µ—Å—Ç—ã (92)
‚îú‚îÄ‚îÄ alembic/             # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ docs/                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ api/             # API Reference
‚îÇ   ‚îî‚îÄ‚îÄ guides/          # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
‚îú‚îÄ‚îÄ .build/              # Production —Å–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ data/                # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (volumes)
‚îî‚îÄ‚îÄ logs/                # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [docs/vision.md - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](docs/vision.md)

---

## üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞

### ‚úÖ Sprint S0: MVP + –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞ + –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- ü§ñ –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram –±–æ—Ç —Å LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- üõ°Ô∏è Fallback –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (85% coverage)
- üîß CI/CD Pipeline
- üê≥ Docker Registry

### ‚úÖ Sprint S1: –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- üêò PostgreSQL 16 + SQLAlchemy 2.0 async
- üîÑ Alembic –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
- üóëÔ∏è Soft delete —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- üë§ Per-user –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ª–∏–º–∏—Ç—ã
- üìä Timezone-aware timestamps

### ‚úÖ Sprint S2: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚ö° Rate limiting middleware (–∑–∞—â–∏—Ç–∞ –æ—Ç spam/DDoS)
- üö¶ Graceful shutdown (–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á)
- üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ (TTL 5 –º–∏–Ω)
- üîÅ Error recovery —Å exponential backoff
- üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ (lazy loading)
- üîç –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ë–î (—É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 80%+)
- üîí Security hardening (sanitization, ValueError protection)
- üìñ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- üß™ 117 —Ç–µ—Å—Ç–æ–≤ (89% coverage)

üìñ –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [docs/roadmap.md](docs/roadmap.md)

---

## üê≥ Docker Registry

–ü—Ä–æ–µ–∫—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—É–±–ª–∏–∫—É–µ—Ç Docker –æ–±—Ä–∞–∑—ã –≤ Yandex Cloud Container Registry –ø—Ä–∏ –∫–∞–∂–¥–æ–º push –≤ `main`.

**–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í–µ—Ä—Å–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `VERSION` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (—Ç–µ–∫—É—â–∞—è: `1.3.2`)
- –ü—Ä–∏ push –≤ `main` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –æ–±—Ä–∞–∑—ã —Å —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π

**–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–±—Ä–∞–∑—ã:**

```bash
# –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è
cr.yandex/{registry-id}/ai-tg-bot:1.3.2

# –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
cr.yandex/{registry-id}/ai-tg-bot:latest
```

**–ö–∞–∫ –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é:**

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `VERSION`: `1.3.2` ‚Üí `1.4.0`
2. –ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ: `git commit -am "chore: bump version to 1.4.0"`
3. Push –≤ `main`: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–µ—Ä—É—Ç—Å—è –æ–±—Ä–∞–∑—ã `1.4.0` –∏ `latest`

**Pull –∏ –∑–∞–ø—É—Å–∫:**

```bash
# –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ Yandex Container Registry
yc container registry configure-docker

# Pull –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏
docker pull cr.yandex/{registry-id}/ai-tg-bot:1.3.2

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d \
  --name ai-tg-bot \
  --env-file .env.production \
  -v $(pwd)/data:/app/data \
  -v $(pwd)/logs:/app/logs \
  --restart unless-stopped \
  cr.yandex/{registry-id}/ai-tg-bot:latest
```

### –¢—Ä–µ–±—É–µ–º—ã–µ GitHub Secrets

–î–ª—è —Ä–∞–±–æ—Ç—ã CI/CD –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ **Settings ‚Üí Secrets and variables ‚Üí Actions**:

| –°–µ–∫—Ä–µ—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `YA_CLOUD_REGISTRY` | JSON –∫–ª—é—á Service Account |
| `YC_REGISTRY_ID` | ID Container Registry |

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

---

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ú—ã —Ä–∞–¥—ã –ª—é–±–æ–º—É –≤–∫–ª–∞–¥—É! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å [CONTRIBUTING.md](CONTRIBUTING.md) –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ:
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∞—Ö –∫–æ–¥–∞
- –ü—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –∫ —Ç–µ—Å—Ç–∞–º
- –°–æ–∑–¥–∞–Ω–∏–∏ Pull Request

–°–ª–µ–¥—É–π—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º KISS –∏ –û–û–ü, –æ–ø–∏—Å–∞–Ω–Ω—ã–º –≤ [docs/vision.md](docs/vision.md).

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤**
