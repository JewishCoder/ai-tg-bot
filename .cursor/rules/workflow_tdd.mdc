---
alwaysApply: true
---
# Workflow TDD: Test-Driven Development

–ü–æ–¥—Ä–æ–±–Ω—ã–µ QA-—Å–æ–≥–ª–∞—à–µ–Ω–∏—è: [@.cursor/rules/qa_conventions.mdc](qa_conventions.mdc)

## –ü—Ä–∏–Ω—Ü–∏–ø—ã TDD

1. **Red ‚Üí Green ‚Üí Refactor** - —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–æ–¥–æ–º
2. **–û–¥–∏–Ω —Ç–µ—Å—Ç = –æ–¥–∏–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π** - –º–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** - –∫–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
4. **–°—Ç—Ä–æ–≥–æ —Å–ª–µ–¥—É–π –ø–ª–∞–Ω—É** –∏–∑ `docs/*tasklist.md`
5. **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ ‚Üí TDD –¶–∏–∫–ª ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**

---

## –¶–∏–∫–ª —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ –∏—Ç–µ—Ä–∞—Ü–∏–µ–π (TDD)

### 1. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è

**–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

- –ü—Ä–æ—á–∏—Ç–∞–π –∑–∞–¥–∞—á–∏ —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏ –∏–∑ `docs/*tasklist.md`
- –ü—Ä–µ–¥–ª–æ–∂–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- **–û–ø—Ä–µ–¥–µ–ª–∏ —Å–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç-–∫–µ–π—Å–æ–≤** –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –ü–æ–∫–∞–∂–∏ –∫–ª—é—á–µ–≤—ã–µ –æ—Ç—Ä–µ–∑–∫–∏ –∫–æ–¥–∞ (—Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–ª–∞—Å—Å–æ–≤, –º–µ—Ç–æ–¥–æ–≤)
- –£–∫–∞–∂–∏ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã
- **–î–æ–∂–¥–∏—Å—å –æ–¥–æ–±—Ä–µ–Ω–∏—è –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞**

**–§–æ—Ä–º–∞—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è:**
```
üìã –ò—Ç–µ—Ä–∞—Ü–∏—è N: [–ù–∞–∑–≤–∞–Ω–∏–µ]

–ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:
- src/example.py - [–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ]
- tests/test_example.py - —Ç–µ—Å—Ç—ã –¥–ª—è example.py

–¢–µ—Å—Ç-–∫–µ–π—Å—ã:
1. test_feature_success - —É—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π
2. test_feature_error_handling - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
3. test_feature_edge_case - –≥—Ä–∞–Ω–∏—á–Ω—ã–π —Å–ª—É—á–∞–π

–ö–ª—é—á–µ–≤–æ–π –∫–æ–¥:
[—Å–∏–≥–Ω–∞—Ç—É—Ä—ã –∫–ª–∞—Å—Å–æ–≤ –∏ –º–µ—Ç–æ–¥–æ–≤]

–ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å TDD —Ü–∏–∫–ª?
```

### 2. TDD –†–µ–∞–ª–∏–∑–∞—Ü–∏—è: Red-Green-Refactor

**–î–ª—è –∫–∞–∂–¥–æ–π —Ñ–∏—á–∏ –ø—Ä–æ—Ö–æ–¥–∏–º TDD —Ü–∏–∫–ª:**

#### üî¥ Phase 1: RED (Failing Test)

**–¶–µ–ª—å:** –ù–∞–ø–∏—Å–∞—Ç—å –ø–∞–¥–∞—é—â–∏–π —Ç–µ—Å—Ç

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞–π/–æ—Ç–∫—Ä–æ–π —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞ `tests/test_<module>.py`
2. –ù–∞–ø–∏—à–∏ —Ç–µ—Å—Ç –¥–ª—è **–æ–¥–Ω–æ–≥–æ** –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
3. –ò—Å–ø–æ–ª—å–∑—É–π Arrange-Act-Assert –ø–∞—Ç—Ç–µ—Ä–Ω
4. –î–æ–±–∞–≤—å docstring —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Ç–µ—Å—Ç–∞
5. –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç - **–æ–Ω –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å** (RED)

**–ö–æ–º–∞–Ω–¥–∞:**
```powershell
make test-fast  # –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
```

**–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞:**
```python
@pytest.mark.asyncio
async def test_save_message_creates_file(test_config: Config) -> None:
    """–¢–µ—Å—Ç: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª."""
    # Arrange
    storage = Storage(test_config)
    user_id = 12345
    messages = [{"role": "user", "content": "test"}]
    
    # Act
    await storage.save_history(user_id, messages)
    
    # Assert
    file_path = test_config.data_dir / f"{user_id}.json"
    assert file_path.exists()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç Phase 1:**
```
üî¥ RED: –¢–µ—Å—Ç test_save_message_creates_file —É–ø–∞–ª
‚ùå AttributeError: 'Storage' object has no attribute 'save_history'
```

---

#### üü¢ Phase 2: GREEN (Minimal Implementation)

**–¶–µ–ª—å:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä–æ–π/—Å–æ–∑–¥–∞–π —Ñ–∞–π–ª —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `src/<module>.py`
2. –ù–∞–ø–∏—à–∏ **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π** –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
3. –ù–µ –¥–æ–±–∞–≤–ª—è–π –∏–∑–±—ã—Ç–æ—á–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
4. –î–æ–±–∞–≤—å type hints –∏ docstrings
5. –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç - **–æ–Ω –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏** (GREEN)

**–ü—Ä–∞–≤–∏–ª–æ –º–∏–Ω–∏–º–∞–ª–∏–∑–º–∞:**
- –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ - —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª
- –ù–µ –ø–∏—à–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é, –µ—Å–ª–∏ —Ç–µ—Å—Ç –µ—ë –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç
- –ù–µ –¥–æ–±–∞–≤–ª—è–π error handling, –µ—Å–ª–∏ –Ω–µ—Ç —Ç–µ—Å—Ç–∞ –Ω–∞ –æ—à–∏–±–∫–∏

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```python
class Storage:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π."""
    
    def __init__(self, config: Config) -> None:
        self.data_dir = Path(config.data_dir)
        self.data_dir.mkdir(parents=True, exist_ok=True)
    
    async def save_history(self, user_id: int, messages: list[dict[str, str]]) -> None:
        """
        –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        
        Args:
            user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            messages: –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
        """
        file_path = self.data_dir / f"{user_id}.json"
        async with aiofiles.open(file_path, "w") as f:
            await f.write(json.dumps({"messages": messages}))
```

**–ö–æ–º–∞–Ω–¥–∞:**
```powershell
make test-fast
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç Phase 2:**
```
üü¢ GREEN: –¢–µ—Å—Ç test_save_message_creates_file –ø—Ä–æ—à—ë–ª
‚úÖ 1 passed
```

---

#### üîµ Phase 3: REFACTOR (Improve Code)

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è

**–®–∞–≥–∏:**
1. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (DRY)
2. –£–ª—É—á—à–∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å (–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
4. –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã - **–≤—Å–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å**
5. –ó–∞–ø—É—Å—Ç–∏ –ª–∏–Ω—Ç–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤

**–ß—Ç–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å:**
- –î—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥ ‚Üí –≤—ã–Ω–µ—Å—Ç–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—é
- –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ ‚Üí –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
- –î–ª–∏–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã ‚Üí —Ä–∞–∑–±–∏—Ç—å –Ω–∞ —á–∞—Å—Ç–∏
- –ù–µ—è—Å–Ω—ã–µ –∏–º–µ–Ω–∞ ‚Üí –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å

**–ö–æ–º–∞–Ω–¥—ã:**
```powershell
# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ—Å—Ç—ã
make test-fast

# 2. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make format

# 3. –õ–∏–Ω—Ç–µ—Ä –∏ —Ç–∏–ø—ã
make lint
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç Phase 3:**
```
üîµ REFACTOR: –ö–æ–¥ —É–ª—É—á—à–µ–Ω
‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
‚úÖ –õ–∏–Ω—Ç–µ—Ä: 0 –æ—à–∏–±–æ–∫
‚úÖ Mypy: OK
```

---

#### üîÅ –ü–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª

**–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç-–∫–µ–π—Å:**
1. –í–µ—Ä–Ω–∏—Å—å –∫ Phase 1 (RED) –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
2. –ü—Ä–æ–π–¥–∏ –≤–µ—Å—å —Ü–∏–∫–ª Red ‚Üí Green ‚Üí Refactor
3. –ü—Ä–æ–¥–æ–ª–∂–∞–π –ø–æ–∫–∞ –≤—Å–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

**–ü—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
```
–¢–µ—Å—Ç 1: test_save_message_creates_file
  üî¥ RED ‚Üí üü¢ GREEN ‚Üí üîµ REFACTOR

–¢–µ—Å—Ç 2: test_load_history_empty_user
  üî¥ RED ‚Üí üü¢ GREEN ‚Üí üîµ REFACTOR

–¢–µ—Å—Ç 3: test_message_limit_enforcement
  üî¥ RED ‚Üí üü¢ GREEN ‚Üí üîµ REFACTOR
```

---

### 3. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö TDD —Ü–∏–∫–ª–æ–≤:**

```powershell
# 1. –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å coverage
make test

# 2. –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞
make lint

# 3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make format
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ Coverage >= 70% –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ª–æ–≥–∏–∫–∏
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ (Mypy)
- ‚úÖ Pre-commit hooks —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

---

### 4. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö unit-—Ç–µ—Å—Ç–æ–≤:**

- –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã –∏–∑ –±–ª–æ–∫–∞ **–¢–µ—Å—Ç** –≤ `tasklist.md`
- –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É –≤ Telegram (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- –£–±–µ–¥–∏—Å—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç end-to-end

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ docker-compose:**
```powershell
# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
docker-compose up --build
```

---

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

**–í `docs/tasklist.md`:**

- –û—Ç–º–µ—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏: `- [x]`
- –û–±–Ω–æ–≤–∏ —Å—Ç–∞—Ç—É—Å –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –£–∫–∞–∂–∏ –¥–∞—Ç—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å—ã:**
- `‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏` ‚Üí `üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ` ‚Üí `‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ`

---

### 6. –ö–æ–º–º–∏—Ç

**–ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—å:**
- [ ] –í—Å–µ TDD —Ü–∏–∫–ª—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã
- [ ] `make test` –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] `make lint` –Ω–µ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–æ–∫
- [ ] `make format` –≤—ã–ø–æ–ª–Ω–µ–Ω
- [ ] Coverage >= 70% –¥–ª—è –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
- [ ] Pre-commit hooks —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

**–§–æ—Ä–º–∞—Ç –∫–æ–º–º–∏—Ç–∞:**
```bash
git add .
git commit -m "feat: [–æ–ø–∏—Å–∞–Ω–∏–µ —Å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º TDD]"
```

**–ü—Ä–∏–º–µ—Ä—ã:**
- `feat: Iteration N - implement Storage with TDD`
- `test: add retry mechanism tests for LLMClient`
- `refactor: improve error handling after TDD cycle`

---

### 7. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

**–§–æ—Ä–º–∞—Ç:**
```
‚úÖ –ò—Ç–µ—Ä–∞—Ü–∏—è N –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (TDD –ø–æ–¥—Ö–æ–¥)

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- [—Å–ø–∏—Å–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á]
- –ù–∞–ø–∏—Å–∞–Ω–æ X —Ç–µ—Å—Ç–æ–≤
- –ü—Ä–æ–π–¥–µ–Ω–æ Y TDD —Ü–∏–∫–ª–æ–≤

TDD –ú–µ—Ç—Ä–∏–∫–∏:
- üî¥ RED: X —Ç–µ—Å—Ç–æ–≤ –Ω–∞–ø–∏—Å–∞–Ω–æ
- üü¢ GREEN: X —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–æ
- üîµ REFACTOR: X —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –ø—Ä–æ–π–¥–µ–Ω–æ
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä: 0 –æ—à–∏–±–æ–∫
- ‚úÖ –¢–∏–ø—ã (mypy): –ø—Ä–æ–π–¥–µ–Ω–æ
- ‚úÖ Pre-commit hooks: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- ‚úÖ Unit-—Ç–µ—Å—Ç—ã: X/X –ø—Ä–æ–π–¥–µ–Ω–æ
- ‚úÖ Coverage: Y% (>= 70%)
- ‚úÖ –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: –ø—Ä–æ–π–¥–µ–Ω–æ

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ –ò—Ç–µ—Ä–∞—Ü–∏–∏ N+1?
```

---

## TDD Best Practices

### –ü–æ—Ä—è–¥–æ–∫ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. **Happy Path** - —É—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ)
2. **Error Handling** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
3. **Edge Cases** - –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏
4. **Integration** - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–ü—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è Storage:**
```python
# 1. Happy Path
test_save_and_load_history()
test_load_history_empty_user()

# 2. Error Handling  
test_save_history_invalid_data()
test_load_history_corrupted_file()

# 3. Edge Cases
test_message_limit_enforcement()
test_empty_history_handling()

# 4. Integration
test_storage_with_llm_client()
```

### –†–∞–∑–º–µ—Ä —à–∞–≥–æ–≤

**–ú–∞–ª–µ–Ω—å–∫–∏–µ —à–∞–≥–∏:**
- ‚úÖ –û–¥–∏–Ω —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–¥–Ω—É –≤–µ—â—å
- ‚úÖ –û–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –∑–∞ —Ä–∞–∑
- ‚úÖ –û–¥–∏–Ω —Å—Ü–µ–Ω–∞—Ä–∏–π –≤ Red-Green-Refactor

**–ë–æ–ª—å—à–∏–µ —à–∞–≥–∏ (–∏–∑–±–µ–≥–∞—Ç—å):**
- ‚ùå –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚ùå –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Ç–æ–¥–æ–≤ —Å—Ä–∞–∑—É
- ‚ùå –ü—Ä–æ–ø—É—Å–∫ RED –∏–ª–∏ GREEN —Ñ–∞–∑

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç –≤ RED?

**–ï—Å–ª–∏ —Ç–µ—Å—Ç —Å—Ä–∞–∑—É GREEN:**
```
‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç –ø—Ä–æ—à—ë–ª –≤ RED —Ñ–∞–∑–µ

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
1. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
2. –¢–µ—Å—Ç —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–æ–π
3. –¢–µ—Å—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ø–∏—Å–∞–Ω
4. –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É

–î–µ–π—Å—Ç–≤–∏—è:
- –ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏ —Ç–µ—Å—Ç
- –£–±–µ–¥–∏—Å—å —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—à—å –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- –£—Å–ª–æ–∂–Ω–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
```

---

## –†–∞–±–æ—Ç–∞ —Å –∫–æ–¥–æ–º

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- –°–ª–µ–¥—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏–∑ `docs/vision.md`
- –û–¥–∏–Ω –∫–ª–∞—Å—Å = –æ–¥–∏–Ω —Ñ–∞–π–ª = –æ–¥–∏–Ω test-—Ñ–∞–π–ª
- `src/module.py` ‚Üî `tests/test_module.py`
- –ü–ª–æ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `src/` –∏ `tests/`

### –°—Ç–∏–ª—å –∫–æ–¥–∞
- Type hints –≤–µ–∑–¥–µ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- Docstrings –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- Async/await –¥–ª—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ –∏–∑ `pyproject.toml`
- –ù–µ –¥–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã–µ –±–µ–∑ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
- Mock –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ —Ç–µ—Å—Ç–∞—Ö

---

## –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è TDD

1. **–ù–µ –ø–∏—à–∏ –∫–æ–¥ –±–µ–∑ —Ç–µ—Å—Ç–∞** - —Å–Ω–∞—á–∞–ª–∞ RED, –ø–æ—Ç–æ–º GREEN
2. **–ù–µ –ø–∏—à–∏ –±–æ–ª—å—à–µ —á–µ–º –Ω—É–∂–Ω–æ** - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ GREEN
3. **–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π REFACTOR** - —É–ª—É—á—à–∞–π –∫–æ–¥ –ø–æ—Å–ª–µ GREEN
4. **–ù–µ –ø–∏—à–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ —Å—Ä–∞–∑—É** - –ø–æ –æ–¥–Ω–æ–º—É –∑–∞ —Ü–∏–∫–ª
5. **–ù–µ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∏—á–µ** –±–µ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è TDD —Ü–∏–∫–ª–∞

---

## –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ TDD —Ü–∏–∫–ª–∞

```
1. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: "–ù–∞—á–Ω–∏ –ò—Ç–µ—Ä–∞—Ü–∏—é N —Å TDD –ø–æ–¥—Ö–æ–¥–æ–º"

2. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è —Å —Ç–µ—Å—Ç-–∫–µ–π—Å–∞–º–∏]
   –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: "–û–¥–æ–±—Ä—è—é"

3. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: 
   üî¥ RED - –ü–∏—à—É test_feature_success
   [–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–∞–¥–∞—é—â–∏–π —Ç–µ—Å—Ç]
   
4. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç:
   üü¢ GREEN - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è feature
   [–¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç]
   
5. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç:
   üîµ REFACTOR - –£–ª—É—á—à–∞—é –∫–æ–¥
   [–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç]

6. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç:
   üî¥ RED - –ü–∏—à—É test_feature_error_handling
   [–¶–∏–∫–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞]

7. [–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–∫–∞ –≤—Å–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã]

8. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞]
   make test, make lint

9. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]

10. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–û–±–Ω–æ–≤–ª—è–µ—Ç tasklist.md]

11. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: "–°–¥–µ–ª–∞–π –∫–æ–º–º–∏—Ç"
    –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: [–î–µ–ª–∞–µ—Ç –∫–æ–º–º–∏—Ç]

12. –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç: "‚úÖ –ò—Ç–µ—Ä–∞—Ü–∏—è N –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ –ò—Ç–µ—Ä–∞—Ü–∏–∏ N+1?"
    –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: "–ù–∞—á–∏–Ω–∞–π –ò—Ç–µ—Ä–∞—Ü–∏—é N+1"
```

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç TDD

–ü–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å:

**TDD –ü—Ä–æ—Ü–µ—Å—Å:**
- [ ] –í—Å–µ —Ç–µ—Å—Ç-–∫–µ–π—Å—ã –ø—Ä–æ–π–¥–µ–Ω—ã —á–µ—Ä–µ–∑ Red-Green-Refactor
- [ ] –ö–∞–∂–¥–∞—è —Ñ–∏—á–∞ –Ω–∞—á–∏–Ω–∞–ª–∞—Å—å —Å –ø–∞–¥–∞—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞ (RED)
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±—ã–ª–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π (GREEN)
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ—Å–ª–µ GREEN —Ñ–∞–∑—ã
- [ ] –ù–µ—Ç –∫–æ–¥–∞ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- [ ] –í—Å–µ –∑–∞–¥–∞—á–∏ –∏–∑ tasklist –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç vision.md –∏ conventions.mdc
- [ ] Type hints –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –∏ –º–µ—Ç–æ–¥–æ–≤
- [ ] Docstrings –¥–ª—è –≤—Å–µ—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:**
- [ ] `make format` –≤—ã–ø–æ–ª–Ω–µ–Ω, –∫–æ–¥ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] `make lint` –Ω–µ –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–æ–∫
- [ ] Mypy –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–∞
- [ ] Pre-commit hooks —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- [ ] Unit-—Ç–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –¥–ª—è –≤—Å–µ–π –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
- [ ] `make test` –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] Coverage >= 70% –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] –¢–µ—Å—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –∏ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–∏–∫—Å—Ç—É—Ä—ã, –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è setup
- [ ] –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- [ ] tasklist.md –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] README.md –æ–±–Ω–æ–≤–ª–µ–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã

**–§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è:**
- [ ] –ö–æ–º–º–∏—Ç —Å–¥–µ–ª–∞–Ω —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º
- [ ] –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –ü–æ–ª—É—á–µ–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

---

## –û—Ç–ª–∏—á–∏—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ Workflow

| –ê—Å–ø–µ–∫—Ç | –û–±—ã—á–Ω—ã–π Workflow | TDD Workflow |
|--------|------------------|--------------|
| –ù–∞—á–∞–ª–æ | –ü–∏—à–µ–º –∫–æ–¥ | –ü–∏—à–µ–º —Ç–µ—Å—Ç |
| –†–µ–∞–ª–∏–∑–∞—Ü–∏—è | –ö–æ–¥ ‚Üí –ø–æ—Ç–æ–º —Ç–µ—Å—Ç—ã | –¢–µ—Å—Ç ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ ‚Üí —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ |
| –ü–æ–∫—Ä—ã—Ç–∏–µ | –¢–µ—Å—Ç—ã –ø–æ—Å–ª–µ –≤—Å–µ–≥–æ | 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –ø–æ –¥–∏–∑–∞–π–Ω—É |
| –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ | –ü–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ñ–∞–∑–∞ —Ü–∏–∫–ª–∞ |
| –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å | –¢–µ—Å—Ç—ã –º–æ–≥—É—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –±–∞–≥–∏ | –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –¥–æ –∫–æ–¥–∞ |

---

**–ü–æ–º–Ω–∏:** 
- üî¥ **RED** = "–Ø –∑–Ω–∞—é —á—Ç–æ —Ö–æ—á—É"
- üü¢ **GREEN** = "–Ø —Å–¥–µ–ª–∞–ª –º–∏–Ω–∏–º—É–º"
- üîµ **REFACTOR** = "–Ø —É–ª—É—á—à–∏–ª –∫–æ–¥"

**TDD = –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å + –ö–∞—á–µ—Å—Ç–≤–æ + –ú–∏–Ω–∏–º–∞–ª–∏–∑–º**
